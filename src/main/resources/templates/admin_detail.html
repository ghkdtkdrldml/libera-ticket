<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" th:replace="fragments :: layout(~{::body})">
<body>
<section>
    <a href="/admin" class="text-sm text-brand/60 underline">← 목록</a>
    <h2 class="text-2xl font-semibold text-brand mb-2">응모 상세</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div class="rounded-xl ring-1 ring-brand/10 p-4 bg-white/70">
            <div class="text-sm"><span class="text-brand/60">ID:</span> <span th:text="${app.applicationId}"></span></div>
            <div class="text-sm"><span class="text-brand/60">생성:</span> <span th:text="${#temporals.format(app.createdAt,'yyyy-MM-dd HH:mm')}"></span></div>
            <div class="text-sm"><span class="text-brand/60">유형:</span> <span th:text="${app.domainType.ko()}"></span></div>
            <div class="text-sm"><span class="text-brand/60">연주자:</span> <span th:text="${app.performer==null?'':app.performer.name}"></span></div>
            <div class="text-sm"><span class="text-brand/60">상태:</span> <span th:text="${app.status.ko()}"></span></div>
            <div class="text-sm"><span class="text-brand/60">인원:</span> <span th:text="${app.totalCount}"></span></div>
            <div class="text-sm"><span class="text-brand/60">대표수령:</span> <span th:text="${app.repDelivery}"></span></div>
            <div class="text-sm"><span class="text-brand/60">대표 연락처:</span>
                <div th:text="${app.repName}"></div>
                <div th:text="${app.repEmail}"></div>
                <div th:text="${app.repPhone}"></div>
            </div>
            <!-- 발급 상태 표시 -->
            <div class="mt-4 text-sm">
                <span class="text-brand/60">티켓 발급 상태:</span>
                <b th:text="${ticketCount > 0 ? '발급됨 (' + ticketCount + '매)' : '미발급'}"></b>
            </div>

            <!-- QR 티켓 발급 버튼 -->
            <form th:action="@{'/admin/applications/' + ${app.applicationId} + '/issue-tickets'}" method="post"
                  onsubmit="return confirm('이 응모의 참석자 전원에게 QR 티켓을 발급하고 메일/문자를 전송합니다. 진행할까요?');"
                  class="mt-3">
                <button type="submit"
                        th:disabled="${ticketCount > 0}"
                        th:classappend="${ticketCount > 0} ? ' opacity-50 cursor-not-allowed' : ''"
                        class="px-4 py-2 rounded-lg bg-brand text-white hover:bg-brand/90">
                    <span th:text="${ticketCount > 0 ? '이미 발급됨' : 'QR 티켓 발급'}"></span>
                </button>
            </form>

            <form th:if="${app.status.name() != 'CANCELED'}"
                  th:action="@{'/admin/applications/' + ${app.applicationId} + '/cancel'}" method="post"
                  onsubmit="return confirm('해당 응모를 취소할까요?');" class="mt-3">
                <button class="px-4 py-2 rounded-lg ring-1 ring-red-200 text-red-700 hover:bg-red-50">취소하기</button>
            </form>
            <div class="mt-3 text-sm">
                <span class="text-brand/60">공개 조회 링크:</span>
                <a th:href="@{'/app/' + ${app.applicationId}}" class="underline" th:text="@{'/app/' + ${app.applicationId}}"></a>
            </div>
        </div>

        <div class="rounded-xl ring-1 ring-brand/10 p-4 bg-white/70">
            <h3 class="font-medium mb-2">구성원</h3>
            <ol class="list-decimal list-inside space-y-1 text-sm">
                <li th:each="m : ${members}">
                    <b th:text="${m.name}"></b>
                    <span class="text-brand/60" th:text="${m.email}"></span>
                    <span class="text-brand/60" th:text="${m.phone}"></span>
                </li>
            </ol>
        </div>
    </div>

    <div class="text-right">
        <a href="/api/export/csv" class="px-4 py-2 rounded-xl ring-1 ring-brand/15">CSV 내보내기</a>
    </div>
</section>
</body>
</html>
